# Generated from https://git.alpinelinux.org/aports/plain/main/ttf-dejavu/APKBUILD?h=3.14-stable
package:
    name: ttf-dejavu
    version: 2.37
    epoch: 0
    description: Font family based on the Bitstream Vera Fonts with a wider range of characters
    target-architecture:
        - noarch
    copyright:
        - paths:
              - "*"
          attestation: TODO
          license: custom
    dependencies:
        runtime:
            - fontconfig
            - encodings
            - mkfontdir
            - mkfontscale
environment:
    contents:
        repositories:
            - https://packages.wolfi.dev/bootstrap/stage3
            - https://packages.wolfi.dev/os
            - /work/packages
        keyring:
            - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
            - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
        packages:
            - busybox
            - ca-certificates-bundle
            - build-base
            - automake
            - autoconf
            - font-util-dev
            - tree

pipeline:
    - uses: fetch
      with:
          expected-sha256: fa9ca4d13871dd122f61258a80d01751d603b4d3ee14095d65453b4e846e17d7
          uri: https://downloads.sourceforge.net/project/dejavu/dejavu/${{package.version}}/dejavu-fonts-ttf-${{package.version}}.tar.bz2
          strip-components: 0
    - uses: fetch
      with:
          expected-sha256: f0ecb95e832a6adfde3e0cc7ec24b6b4e3471b3fc658125c8e57f981cb495689
          uri: https://downloads.sourceforge.net/project/dejavu/dejavu/${{package.version}}/dejavu-lgc-fonts-ttf-${{package.version}}.tar.bz2
          strip-components: 0
    - runs: tree
    - runs: |
          mkdir -p ${{targets.destdir}}/usr/share/fonts/${{package.name}} \
              ${{targets.destdir}}/etc/fonts/conf.avail \
              ${{targets.destdir}}/etc/fonts/conf.d

          install -m644 dejavu-fonts-ttf-${{package.version}}/ttf/*.ttf \
              dejavu-lgc-fonts-ttf-${{package.version}}/ttf/*.ttf \
              ${{targets.destdir}}/usr/share/fonts/${{package.name}}

          install -m644 dejavu-fonts-ttf-${{package.version}}/fontconfig/*.conf \
              dejavu-lgc-fonts-ttf-${{package.version}}/fontconfig/*.conf \
              ${{targets.destdir}}/etc/fonts/conf.avail

            # cd "$pkgdir"/etc/fonts/conf.d
            # for j in "$srcdir"/*.conf; do
            #     install -m644 "$j" "$pkgdir"/etc/fonts/conf.avail/
            #     ln -sf /etc/fonts/conf.avail/${j##*/}
            # done
      #   srcdir=$(pwd)
      #   cd ${{targets.destdir}}/etc/fonts/conf.d
      #   for j in "$srcdir"/*.conf; do
      #       echo "here: $j"
      #       install -m644 "$j" ${{targets.destdir}}/etc/fonts/conf.avail/
      #       ln -sf /etc/fonts/conf.avail/${j##*/}
      #   done

      #   mkdir -p ${{targets.subpkgdir}}/usr/share
      #   mv ${{targets.destdir}}/usr/bin ${{targets.subpkgdir}}/usr/

# FIXME lets check this - the script above doesn't find any .conf files
