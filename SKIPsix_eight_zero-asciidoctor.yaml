# Generated from https://git.alpinelinux.org/aports/plain/main/asciidoctor/APKBUILD
package:
    name: asciidoctor
    version: 2.0.17
    epoch: 0
    description: Converter for AsciiDoc to HTML5, DocBook 5 (or 4.5) and other formats
    target-architecture:
        - noarch
    copyright:
        - paths:
              - "*"
          attestation: TODO
          license: MIT
environment:
    contents:
        repositories:
            - https://packages.wolfi.dev/bootstrap/stage3
            - https://packages.wolfi.dev/os
            - /work/packages
        keyring:
            - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
            - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
        packages:
            - busybox
            - ca-certificates-bundle
            - build-base
            - automake
            - autoconf
            - ruby
pipeline:
    - uses: fetch
      with:
          expected-sha256: ed5b5e399e8d64994cc16f0983f993d6e33990909a8415b6fc8b786cdeb00f3d
          uri: https://rubygems.org/downloads/asciidoctor-${{package.version}}.gem
    - runs: |
          #   local gemdir="$(ruby -e 'puts Gem.default_dir')"

          #   gem install \
          #       --local \
          #       --install-dir "$pkgdir"/$gemdir \
          #       --ignore-dependencies \
          #       --verbose \
          #       --no-document \
          #       "$srcdir"/$pkgname-$pkgver.gem

          #   rm -rf "$pkgdir"/$gemdir/cache

          #   cd "$pkgdir"
          #   local i; for i in usr/lib/ruby/gems/*/bin/*; do
          #       if [ -e "$i" ]; then
          #           mkdir -p "$pkgdir"/usr/bin
          #           ln -s /$i "$pkgdir"/usr/bin/
          #       fi
          #   done
            gemdir="$(ruby -e 'puts Gem.default_dir')"

            gem install \
                --local \
                --install-dir ${{targets.destdir}}/$gemdir \
                --ignore-dependencies \
                --verbose \
                --no-document \
                ${{targets.destdir}}/${{package.name}}-${{package.version}}.gem

            rm -rf ${{targets.destdir}}/$gemdir/cache

            cd ${{targets.destdir}}
            local i; for i in usr/lib/ruby/gems/*/bin/*; do
                if [ -e "$i" ]; then
                    mkdir -p ${{targets.destdir}}/usr/bin
                    ln -s /$i ${{targets.destdir}}/usr/bin/
                fi
            done
