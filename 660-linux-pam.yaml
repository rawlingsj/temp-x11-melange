# Generated from https://git.alpinelinux.org/aports/plain/main/linux-pam/APKBUILD
package:
    name: linux-pam
    version: 1.5.2
    description: Linux PAM (Pluggable Authentication Modules for Linux)
    target-architecture:
        - all
    copyright:
        - paths:
              - "*"
          attestation: TODO
          license: BSD-3-Clause
environment:
    contents:
        repositories:
            - https://packages.wolfi.dev/bootstrap/stage3
            - https://packages.wolfi.dev/os
            - /work/packages
        keyring:
            - https://packages.wolfi.dev/bootstrap/stage3/wolfi-signing.rsa.pub
            - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
        packages:
            - busybox
            - ca-certificates-bundle
            - build-base
            - automake
            - autoconf
            - gettext-dev
            - bison
            - flex-dev
            - libtool
            - linux-headers
pipeline:
    - uses: fetch
      with:
          expected-sha256: e4ec7131a91da44512574268f493c6d8ca105c87091691b8e9b56ca685d4f94d
          uri: https://github.com/linux-pam/linux-pam/releases/download/v${{package.version}}/Linux-PAM-${{package.version}}.tar.xz
    - runs: |
          #   # disable insecure modules
          #   sed -e 's/pam_rhosts//g' -i modules/Makefile.am

          #   autoreconf -vif

    # TODO - disabling insecure modules sounds good, let's figure out how to modify and regen with automake
    - uses: autoconf/configure
      with:
          opts: |
              --disable-nls \
              --disable-db
    - uses: autoconf/make
    - uses: autoconf/make-install
    - uses: strip
subpackages:
    - name: linux-pam-dev
      pipeline:
          - uses: split/dev
            dependencies:
            runtime:
                - linux-pam
                - gettext-dev
            description: linux-pam-dev
